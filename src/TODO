code merger

TIP bug
enhance to make tests ok.
